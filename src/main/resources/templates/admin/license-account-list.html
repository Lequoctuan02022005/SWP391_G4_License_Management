<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>License Accounts</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>

    <style>
        body { background:#f5f7fa; font-family:"Inter", sans-serif; }
        .page-title { font-weight:700; font-size:28px; }
        .card { border-radius:12px; }
        thead.table-header { background:#1f2937; color:#fff; font-size:15px; }
        .action-btn { border-radius:6px; padding:6px 14px; }
        .search-box input, .search-box select { border-radius:8px; }
        .table td, .table th { vertical-align:middle; }
        .badge-soft { background:#eef2ff; color:#3730a3; }
        .pagination .page-link { border-radius:6px !important; }
    </style>
</head>
<body>

<div th:replace="admin/admin-header :: adminHeader"></div>

<div class="container mt-5">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="page-title">License Account List</h2>
        <a class="btn btn-dark action-btn" th:href="@{/system-admin/license-accounts/create}">+ Create</a>
    </div>

    <div th:if="${success}" class="alert alert-success shadow-sm" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-danger shadow-sm" th:text="${error}"></div>

    <!-- Filter -->
    <div class="card shadow-sm mb-3">
        <div class="card-body">
            <form method="get" th:action="@{/system-admin/license-accounts}" class="row g-2 search-box">
                <div class="col-md-5">
                    <input class="form-control" type="text" name="q"
                           placeholder="Search username/token/license/tool" th:value="${q}"/>
                </div>

                <div class="col-md-2">
                    <input class="form-control" type="number" name="toolId"
                           placeholder="toolId (optional)" th:value="${toolId}"/>
                </div>

                <div class="col-md-2">
                    <select class="form-select" name="status">
                        <option value="">-- Status --</option>
                        <option value="ACTIVE"
                                th:selected="${status != null and status.name() == 'ACTIVE'}">ACTIVE</option>
                        <option value="EXPIRED"
                                th:selected="${status != null and status.name() == 'EXPIRED'}">EXPIRED</option>
                        <option value="REVOKED"
                                th:selected="${status != null and status.name() == 'REVOKED'}">REVOKED</option>
                    </select>
                </div>

                <div class="col-md-2">
                    <select class="form-select" name="used">
                        <option value="">-- Used --</option>
                        <option value="true" th:selected="${used != null and used == true}">true</option>
                        <option value="false" th:selected="${used != null and used == false}">false</option>
                    </select>
                </div>

                <div class="col-md-1 d-grid">
                    <button class="btn btn-outline-dark action-btn">Filter</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Table -->
    <div class="card shadow-sm">
        <div class="card-body">
            <table class="table table-hover align-middle text-center">
                <thead class="table-header">
                <tr>
                    <th>ID</th>
                    <th>Tool / License</th>
                    <th>Login method</th>
                    <th>Credential</th>
                    <th>Start</th>
                    <th>End</th>
                    <th>Status</th>
                    <th>Used</th>
                    <th width="200px">Action</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="x : ${items}">
                    <td th:text="${x.licenseAccountId}"></td>

                    <td class="text-start">
                        <div>
                            <span class="badge badge-soft px-3 py-2"
                                  th:text="${(x.license != null and x.license.tool != null) ? x.license.tool.toolName : 'N/A'}">
                            </span>
                        </div>
                        <div class="mt-1"
                             th:text="${x.license != null ? x.license.name : 'N/A'}"></div>
                    </td>

                    <td th:text="${(x.license != null and x.license.tool != null) ? x.license.tool.loginMethod : ''}">METHOD</td>

                    <td class="text-start">
                        <div th:if="${x.username != null}">
                            <b>Username:</b> <span th:text="${x.username}"></span><br/>
                            <b>Password:</b> <span th:text="${x.password}"></span>
                        </div>
                        <div th:if="${x.username == null and x.token != null}">
                            <b>Token:</b> <span th:text="${x.token}"></span>
                        </div>
                        <div th:if="${x.username == null and x.token == null}" class="text-muted">N/A</div>
                    </td>

                    <td th:text="${x.startDate != null ? #temporals.format(x.startDate,'yyyy-MM-dd HH:mm') : ''}"></td>
                    <td th:text="${x.endDate != null ? #temporals.format(x.endDate,'yyyy-MM-dd HH:mm') : ''}"></td>
                    <td th:text="${x.status}"></td>
                    <td th:text="${x.used}"></td>

                    <td>
                        <a class="btn btn-warning btn-sm action-btn me-1"
                           th:href="@{/system-admin/license-accounts/{id}/edit(id=${x.licenseAccountId})}">Edit</a>
                        <a class="btn btn-outline-dark btn-sm action-btn"
                           th:href="@{/system-admin/license-accounts/{id}/renew(id=${x.licenseAccountId})}">Renew</a>
                    </td>
                </tr>

                <tr th:if="${items == null or #lists.isEmpty(items)}">
                    <td colspan="9" class="text-muted py-4">No data</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>
</body>
</html>

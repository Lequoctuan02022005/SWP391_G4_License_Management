<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Upgrade Seller Account</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <link rel="stylesheet" th:href="@{/css/renew-package.css}">
</head>

<body>
<div th:replace="common/sidebar-header :: role-sidebar">
    <th:block th:fragment="content">

<div class="page-wrapper">

    <div class="premium-container">

        <h2 class="fw-bold text-center mb-2 title">Upgrade Seller Account</h2>
        <p class="text-center subtitle">Choose a suitable package to continue using the tool selling feature</p>

        <!-- Success message -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle me-2"></i>
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <!-- Error message -->
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <div class="alert-premium" th:if="${isNewSeller}">
            <i class="bi bi-exclamation-triangle"></i>
            <span>Please select a package to become a Seller.</span>
        </div>

        <div class="alert-premium" th:if="${!isNewSeller and expired}">
            <i class="bi bi-exclamation-triangle"></i>
            <span>Your Seller package has expired. Please renew to continue selling tools.</span>
        </div>

        <div class="alert alert-info" th:if="${!isNewSeller and !expired}">
            <i class="bi bi-info-circle me-2"></i>
            <span>Your Seller package is valid until: <strong th:text="${#temporals.format(currentExpiry, 'dd/MM/yyyy HH:mm')}"></strong></span>
        </div>

        <!-- No Seller Package Available -->
        <div class="alert-warning-premium" th:if="${packages.size() == 0}">
            <i class="bi bi-info-circle"></i>
            Currently, there are no Seller packages available for sale. Please contact Admin.
        </div>

        <form method="post" th:action="@{/seller/renew}">
            <input type="hidden" name="packageId" id="selectedPackage">

            <div class="row gy-4 gx-4 justify-content-center">

                <!-- Card Package -->
                <div class="col-md-4" th:each="p : ${packages}">
                    <div class="package-card" th:data-id="${p.id}" onclick="selectPackage(this)">

                        <div class="package-header">
                            <h4 class="fw-bold" th:text="${p.packageName}"></h4>
                        </div>

                        <p class="duration">
                            <i class="bi bi-clock"></i>
                            <span th:text="${p.durationInMonths} + ' months'"></span>
                        </p>

                        <h4 class="price" th:text="${#numbers.formatDecimal(p.price, 0, 'POINT', 0, 'POINT')} + ' VND'"></h4>

                        <p class="desc" th:text="${p.description}"></p>
                    </div>
                </div>

            </div>

            <button id="submitBtn" type="submit" class="btn-premium mt-4 w-100 fw-bold" style="display: none;">
                Pay via VNPay
            </button>

            <a href="/home" class="btn-back w-100 mt-3">Back to Home</a>
        </form>
    </div>
</div>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- JS -->
<script>
    function selectPackage(card) {
        // Remove selected class from all cards
        document.querySelectorAll(".package-card")
            .forEach(c => c.classList.remove("selected"));

        // Add selected class to clicked card
        card.classList.add("selected");

        // Set hidden input value
        document.getElementById("selectedPackage").value = card.getAttribute("data-id");
        
        // Show submit button
        document.getElementById("submitBtn").style.display = "block";
    }

    // Validate form before submit
    document.querySelector('form').addEventListener('submit', function(e) {
        const selectedPackage = document.getElementById("selectedPackage").value;
        if (!selectedPackage || selectedPackage === '') {
            e.preventDefault();
            alert('Please select a package before payment!');
            return false;
        }
        
        // Show loading
        const btn = document.getElementById("submitBtn");
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Redirecting to VNPay...';
    });
</script>
    </th:block>
</div>
</body>
</html>

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>License Renewal History</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link th:href="@{/css/home.css}" rel="stylesheet">
</head>

<body>

<!-- ================= SELLER ================= -->
<th:block th:if="${role == 'SELLER'}">
    <div th:replace="common/sidebar-header :: role-sidebar">
        <th:block th:fragment="content">

            <!-- ================= CONTENT ================= -->
            <div class="container-fluid mt-4">
                <div class="card shadow-sm">

                    <!-- TITLE -->
                    <div class="card-header bg-white">
                        <h5 class="fw-bold mb-0">License Renewal History</h5>
                    </div>

                    <!-- FILTER -->
                    <div class="card-body border-bottom">
                        <form method="get" class="row g-3 align-items-end">

                            <div class="col-md-2">
                                <label class="form-label">From date</label>
                                <input type="date" name="fromDate" class="form-control"
                                       th:value="${fromDate}">
                            </div>

                            <div class="col-md-2">
                                <label class="form-label">To date</label>
                                <input type="date" name="toDate" class="form-control"
                                       th:value="${toDate}">
                            </div>

                            <div class="col-md-2">
                                <label class="form-label">Amount from</label>
                                <input type="number" name="minAmount" class="form-control"
                                       th:value="${minAmount}">
                            </div>

                            <div class="col-md-2">
                                <label class="form-label">Amount to</label>
                                <input type="number" name="maxAmount" class="form-control"
                                       th:value="${maxAmount}">
                            </div>

                            <div class="col-md-2">
                                <button class="btn btn-primary w-100">Apply</button>
                            </div>

                            <div class="col-md-2">
                                <button type="button"
                                        class="btn btn-outline-secondary w-100"
                                        onclick="clearFilters()">
                                    Clear
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- TABLE -->
                    <div class="card-body p-0">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>License</th>
                                <th>Renewal date</th>
                                <th>New expiry</th>
                                <th>Amount</th>
                            </tr>
                            </thead>

                            <tbody>
                            <tr th:each="log, i : ${page.content}">
                                <td th:text="${i.count}"></td>
                                <td th:text="${log.licenseAccount.license.licenseName}"></td>
                                <td th:text="${#temporals.format(log.renewDate,'dd/MM/yyyy HH:mm')}"></td>
                                <td th:text="${#temporals.format(log.newEndDate,'dd/MM/yyyy HH:mm')}"></td>
                                <td th:text="${#numbers.formatDecimal(log.amountPaid,0,'COMMA',0,'POINT')} + ' VND'"></td>
                            </tr>

                            <tr th:if="${page.totalElements == 0}">
                                <td colspan="5" class="text-center text-muted py-4">
                                    No data
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- PAGINATION -->
                    <div class="card-footer bg-white d-flex justify-content-between">
                        <span>
                            Page <b th:text="${page.number + 1}"></b> /
                            <b th:text="${page.totalPages}"></b> —
                            Total <b th:text="${page.totalElements}"></b> records
                        </span>

                        <div class="btn-group">
                            <a class="btn btn-outline-secondary"
                               th:if="${page.hasPrevious()}"
                               th:href="@{
                                 ?page=${page.number - 1}
                                 &fromDate=${fromDate}
                                 &toDate=${toDate}
                                 &minAmount=${minAmount}
                                 &maxAmount=${maxAmount}
                               }">
                                « Previous
                            </a>

                            <a class="btn btn-outline-secondary"
                               th:if="${page.hasNext()}"
                               th:href="@{
                                 ?page=${page.number + 1}
                                 &fromDate=${fromDate}
                                 &toDate=${toDate}
                                 &minAmount=${minAmount}
                                 &maxAmount=${maxAmount}
                               }">
                                Next »
                            </a>
                        </div>
                    </div>

                </div>
            </div>
            <!-- ================= END CONTENT ================= -->

        </th:block>
    </div>
</th:block>

<!-- ================= CUSTOMER ================= -->
<th:block th:if="${role == 'CUSTOMER'}">

    <!-- HEADER -->
    <div th:replace="common/header :: header"></div>

    <!-- CONTENT -->
    <div class="container-fluid mt-4">
        <div class="card shadow-sm">

            <!-- TITLE -->
            <div class="card-header bg-white">
                <h5 class="fw-bold mb-0">License Renewal History</h5>
            </div>

            <!-- FILTER + TABLE + PAGINATION (Y HỆT SELLER) -->
            <!-- COPY NGUYÊN KHỐI Ở TRÊN XUỐNG, KHÔNG ĐỔI GÌ -->

            <!-- FILTER -->
            <div class="card-body border-bottom">
                <form method="get" class="row g-3 align-items-end">
                    <div class="col-md-2">
                        <label class="form-label">From date</label>
                        <input type="date" name="fromDate" class="form-control" th:value="${fromDate}">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">To date</label>
                        <input type="date" name="toDate" class="form-control" th:value="${toDate}">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Amount from</label>
                        <input type="number" name="minAmount" class="form-control" th:value="${minAmount}">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Amount to</label>
                        <input type="number" name="maxAmount" class="form-control" th:value="${maxAmount}">
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary w-100">Apply</button>
                    </div>
                    <div class="col-md-2">
                        <button type="button"
                                class="btn btn-outline-secondary w-100"
                                onclick="clearFilters()">
                            Clear
                        </button>
                    </div>
                </form>
            </div>

            <!-- TABLE -->
            <div class="card-body p-0">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>License</th>
                        <th>Renewal date</th>
                        <th>New expiry</th>
                        <th>Amount</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="log, i : ${page.content}">
                        <td th:text="${i.count}"></td>
                        <td th:text="${log.licenseAccount.license.licenseName}"></td>
                        <td th:text="${#temporals.format(log.renewDate,'dd/MM/yyyy HH:mm')}"></td>
                        <td th:text="${#temporals.format(log.newEndDate,'dd/MM/yyyy HH:mm')}"></td>
                        <td th:text="${#numbers.formatDecimal(log.amountPaid,0,'COMMA',0,'POINT')} + ' VND'"></td>
                    </tr>
                    <tr th:if="${page.totalElements == 0}">
                        <td colspan="5" class="text-center text-muted py-4">No data</td>
                    </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</th:block>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function clearFilters() {
        // clear input
        document.querySelectorAll(
            'input[name="fromDate"], ' +
            'input[name="toDate"], ' +
            'input[name="minAmount"], ' +
            'input[name="maxAmount"]'
        ).forEach(input => input.value = '');

        // clear page param nếu có
        const url = new URL(window.location);
        url.searchParams.delete("page");
        window.history.replaceState({}, '', url);
    }
</script>
</body>
</html>

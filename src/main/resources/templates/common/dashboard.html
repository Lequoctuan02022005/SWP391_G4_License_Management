<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>

    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar-header.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

</head>
<body>

<!-- ================= SIDEBAR ================= -->
<div th:replace="common/sidebar-header :: role-sidebar">

    <!-- ================= PAGE CONTENT ================= -->
    <div th:fragment="content">

        <div class="dashboard-container">

            <!-- ================= HEADER ================= -->
            <div class="dashboard-header">
                <div class="header-left">
                    <h1>Dashboard</h1>
                    <p class="header-subtitle" th:text="'Welcome back, ' + ${account.fullName} + '!'"></p>
                </div>
                <span class="role-badge" th:text="${role}"></span>
            </div>

            <!-- ================= ADMIN DASHBOARD ================= -->
            <th:block th:if="${role == 'ADMIN'}">
                
                <!-- KPI CARDS -->
                <section class="dashboard-grid kpi-section">
                    <div class="card kpi blue">
                        <div class="kpi-icon"><i class="bi bi-people-fill"></i></div>
                        <span>Total accounts</span>
                        <strong th:text="${totalAccounts}"></strong>
                        <small class="kpi-change">Active users</small>
                    </div>

                    <div class="card kpi green">
                        <div class="kpi-icon"><i class="bi bi-shop"></i></div>
                        <span>Total sellers</span>
                        <strong th:text="${totalSellers}"></strong>
                        <small class="kpi-change">Registered</small>
                    </div>

                    <div class="card kpi purple">
                        <div class="kpi-icon"><i class="bi bi-box-seam"></i></div>
                        <span>Total tools</span>
                        <strong th:text="${totalTools}"></strong>
                        <small class="kpi-change">Available</small>
                    </div>

                    <div class="card kpi red">
                        <div class="kpi-icon"><i class="bi bi-flag-fill"></i></div>
                        <span>Total reports</span>
                        <strong th:text="${totalReports}"></strong>
                        <small class="kpi-change">Need review</small>
                    </div>
                </section>

                <!-- QUICK STATS -->
                <section class="quick-stats">


                    <div class="stat-box">
                        <h4>Quick links</h4>
                        <div class="quick-links">
                            <a href="/admin/accounts"><i class="bi bi-people"></i> Manage Accounts</a>
                            <a href="/admin/roles"><i class="bi bi-shield-check"></i> Manage Roles</a>
                            <a href="/admin/financial-report"><i class="bi bi-graph-up"></i> Financial Report</a>
                        </div>
                    </div>
                </section>
            </th:block>


            <!-- ================= SELLER DASHBOARD ================= -->
            <th:block th:if="${role == 'SELLER'}">

                <!-- KPI CARDS -->
                <section class="dashboard-grid kpi-section">
                    <div class="card kpi blue">
                        <div class="kpi-icon"><i class="bi bi-box-seam"></i></div>
                        <span>Total tools</span>
                        <strong th:text="${totalTools}"></strong>
                        <small class="kpi-change">Your products</small>
                    </div>

                    <div class="card kpi green">
                        <div class="kpi-icon"><i class="bi bi-check-circle-fill"></i></div>
                        <span>Published</span>
                        <strong th:text="${publishedTools}"></strong>
                        <small class="kpi-change">Active</small>
                    </div>

                    <div class="card kpi warning">
                        <div class="kpi-icon"><i class="bi bi-clock"></i></div>
                        <span>Pending / Rejected</span>
                        <strong th:text="${pendingRejectedTools}"></strong>
                        <small class="kpi-change">Need review</small>
                    </div>

                    <div class="card kpi success">
                        <div class="kpi-icon"><i class="bi bi-cash-coin"></i></div>
                        <span>Total revenue</span>
                        <strong th:text="${#numbers.formatDecimal(revenue, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></strong>
                        <small class="kpi-change">All time</small>
                    </div>
                </section>

                <!-- SELLER PACKAGE STATUS -->
                <section class="seller-package">
                    <div class="package-card">
                        <div class="package-header">
                            <h3><i class="bi bi-gift"></i> Seller Package</h3>


                        </div>

                        <div class="package-content">
                            <p class="package-info">
                                Days left: <strong th:text="${packageDaysLeft} + ' days'"></strong>
                            </p>
                            <a th:if="${packageStatus != 'ACTIVE'}" href="/seller/renew" class="btn-renew">
                                <i class="bi bi-arrow-repeat"></i> Renew
                            </a>
                        </div>
                    </div>
                </section>

                <!-- ANALYSIS OF TOOL STATUS -->
                <div class="full-card">
                    <h2><i class="bi bi-pie-chart"></i> Analysis of tool status</h2>
                    <div class="status-grid">
                        <div class="status-item">
                            <span class="status-label">Pending review</span>
                            <span class="status-count pending" th:text="${pendingCount}"></span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Approved</span>
                            <span class="status-count approved" th:text="${approvedCount}"></span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Published</span>
                            <span class="status-count published" th:text="${publishedCount}"></span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Rejected</span>
                            <span class="status-count rejected" th:text="${rejectedCount}"></span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Suspect</span>
                            <span class="status-count suspect" th:text="${suspectCount}"></span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Deactivated</span>
                            <span class="status-count deactivated" th:text="${deactivatedCount}"></span>
                        </div>
                    </div>
                </div>

                <!-- REVENUE OF LAST 5 MONTHS -->
                <div class="full-card">
                    <h2><i class="bi bi-graph-up"></i> Revenue of last 5 months</h2>
                    <table class="revenue-table">
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Revenue</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="m, i : ${revenueMonths}">
                                <td th:text="${m}"></td>
                                <td class="revenue-value" th:text="${#numbers.formatDecimal(revenueValues[i.index], 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </th:block>

            <!-- ================= MANAGER DASHBOARD ================= -->
            <th:block th:if="${role == 'MANAGER'}">

                <!-- KPI CARDS -->
                <section class="dashboard-grid kpi-section">
                    

                    <div class="card kpi danger">
                        <div class="kpi-icon"><i class="bi bi-exclamation-triangle-fill"></i></div>
                        <span>Suspect tools</span>
                        <strong th:text="${suspectTools}"></strong>
                        <small class="kpi-change">Need attention</small>
                    </div>

                    <div class="card kpi blue">
                        <div class="kpi-icon"><i class="bi bi-check2-circle"></i></div>
                        <span>Published tools</span>
                        <strong th:text="${publishedTools}"></strong>
                        <small class="kpi-change">Available</small>
                    </div>

                    <div class="card kpi success">
                        <div class="kpi-icon"><i class="bi bi-file-earmark-text"></i></div>
                        <span>Published blogs</span>
                        <strong th:text="${publishedBlogs}"></strong>
                        <small class="kpi-change">Active</small>
                    </div>

                    <div class="card kpi info">
                        <div class="kpi-icon"><i class="bi bi-tasks"></i></div>
                        <span>Total tasks</span>
                        <strong th:text="${pendingTools + suspectTools}"></strong>
                        <small class="kpi-change">In progress</small>
                    </div>
                </section>

                <!-- TOP BLOGS -->
                <div class="full-card">
                    <h2><i class="bi bi-graph-up"></i> Top blogs by view count</h2>
                    <div th:if="${topBlogs.size() > 0}">
                        <table class="blog-table">
                            <thead>
                                <tr>
                                    <th>Blog title</th>
                                    <th class="views-col">View count</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="b, idx : ${topBlogs}">
                                    <td>
                                        <span class="blog-rank" th:text="${idx.count}"></span>
                                        <span th:text="${b.title}"></span>
                                    </td>
                                    <td class="views-col">
                                        <span class="badge" th:classappend="${idx.count <= 2} ? 'badge-gold' : 'badge-gray'" th:text="${b.viewCount} + ' lượt xem'"></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div th:if="${topBlogs.size() == 0}" class="empty-state">
                        <p>No published blogs</p>
                    </div>
                </div>

                <!-- QUICK ACTIONS -->
                <section class="quick-stats">
                    <div class="stat-box">
                        <h4>Quick actions</h4>
                        <div class="quick-links">
                            <a href="/manager/upload-tools"><i class="bi bi-cloud-upload"></i> View upload requests</a>
                            <a href="/manager/blogs"><i class="bi bi-file-earmark-text"></i> Manage blogs</a>
                            <a href="/manager/statistics"><i class="bi bi-bar-chart"></i> View statistics</a>
                        </div>
                    </div>
                </section>

            </th:block>

            <!-- ================= MOD DASHBOARD ================= -->
            <th:block th:if="${role == 'MOD'}">

                <!-- PENDING REPORTS -->
                <section class="dashboard-grid kpi-section">
                    <div class="card kpi warning">
                        <div class="kpi-icon"><i class="bi bi-clock"></i></div>
                        <span>Pending reports</span>
                        <strong th:text="${pendingTools}"></strong>
                        <small class="kpi-change">Need review</small>
                    </div>

                    <div class="card kpi info">
                        <div class="kpi-icon"><i class="bi bi-check2-circle"></i></div>
                        <span>Need review requests</span>
                        <strong th:text="${totalPendingReports}"></strong>
                        <small class="kpi-change">Need review</small>
                    </div>

                    <div class="card kpi success">
                        <div class="kpi-icon"><i class="bi bi-check-all"></i></div>
                        <span>Approved today</span>
                        <strong>-</strong>
                        <small class="kpi-change">Today</small>
                    </div>


                </section>

                <!-- TOOL REPORTS -->
                <div class="full-card">
                    <h2><i class="bi bi-flag"></i> Tool reports need review</h2>
                    <div th:if="${pendingToolReports.size() > 0}">
                        <div class="reports-list">
                            <div th:each="r : ${pendingToolReports}" class="report-item">
                                <div class="report-header">
                                    <span class="report-id">#<span th:text="${r.toolReportId}"></span></span>
                                    <span class="report-reason" th:text="${r.reason}"></span>
                                </div>
                                <div class="report-details">
                                    <p><strong>Tool:</strong> <span th:text="${r.tool.toolName}"></span></p>
                                    <p><strong>Report by:</strong> <span th:text="${r.account.fullName}"></span></p>
                                    <p><strong>Description:</strong> <span th:text="${r.description}"></span></p>
                                </div>
                                <div class="report-actions">
                                    <a href="#" class="btn-action approve"><i class="bi bi-check"></i> Approve</a>
                                    <a href="#" class="btn-action reject"><i class="bi bi-x"></i> Reject</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div th:if="${pendingToolReports.size() == 0}" class="empty-state">
                        <i class="bi bi-inbox"></i>
                        <p>No reports need review</p>
                    </div>
                </div>

                <!-- QUICK LINKS -->
                <section class="quick-stats">
                    <div class="stat-box">
                        <h4>Manager tools</h4>
                        <div class="quick-links">
                            <a href="/mod/tools"><i class="bi bi-check2-circle"></i> Review tools</a>
                            <a href="/moderator/upload-requests"><i class="bi bi-cloud-upload"></i> Upload requests</a>
                            <a href="/mod/reports"><i class="bi bi-flag"></i> View all reports</a>
                        </div>
                    </div>
                </section>

            </th:block>

        </div>


    </div>

</div>

</body>
</html>

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Personal information</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link th:href="@{/css/profile.css}" rel="stylesheet">
    <link th:href="@{/css/home.css}" rel="stylesheet">

</head>
<body>

<div th:if="${account == null or account.role.roleName.name() == 'CUSTOMER'}">
    <div th:replace="common/header :: header"></div>
    <div class="container py-5">

    <div class="profile-wrapper mx-auto">

        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="fw-bold mb-1">Account information</h2>
                <p class="text-muted mb-0">Manage your personal information and account security.</p>
            </div>
        </div>

        <!-- Alerts -->
        <div th:if="${param.updated}" class="alert alert-success mb-4">
            Information has been updated successfully.
        </div>
        <div th:if="${param.avatarUpdated}" class="alert alert-success mb-4">
            Avatar has been updated successfully.
        </div>

        <!-- Avatar -->
        <div class="text-center mb-4">
            <img th:if="${profile.images != null}"
                 th:src="@{'/uploads/avatar/' + ${profile.images}}"
                 class="rounded-circle shadow-sm"
                 style="width: 120px; height: 120px; object-fit: cover;"
                 alt="Avatar">
            <img th:if="${profile.images == null}"
                 th:src="@{'/uploads/avatar/default.png'}"
                 class="rounded-circle shadow-sm"
                 style="width: 120px; height: 120px; object-fit: cover;"
                 alt="Avatar">
        </div>



        <!-- Button upload avatar -->
        <div class="text-center mb-4">
            <button class="btn btn-dark-soft" data-bs-toggle="modal" data-bs-target="#updateAvatarModal">
                Change avatar
            </button>
        </div>

        <!-- Card nội dung -->
        <div class="profile-card shadow-sm rounded-4 p-4">

            <!-- Hàng 1: Họ tên + Email -->
            <div class="row mb-3">
                <div class="col-md-6 mb-3 mb-md-0">
                    <label class="form-label text-muted">Full name</label>
                    <div class="info-value" th:text="${profile.fullName}">Nguyễn Văn A</div>
                </div>
                <div class="col-md-6">
                    <label class="form-label text-muted">Email (cannot be changed)</label>
                    <input class="form-control info-readonly" th:value="${profile.email}" readonly>
                </div>
            </div>

            <!-- Hàng 2: SĐT + Địa chỉ -->
            <div class="row mb-3">
                <div class="col-md-6 mb-3 mb-md-0">
                    <label class="form-label text-muted">Phone</label>
                    <div class="info-value" th:text="${profile.phone}">0123456789</div>
                </div>
                <div class="col-md-6">
                    <label class="form-label text-muted">Address</label>
                    <div class="info-value" th:text="${profile.address}">Hà Nội</div>
                </div>
            </div>

            <!-- Hàng 3: Ngày tạo + Trạng thái -->
            <div class="row mb-3">
                <div class="col-md-6 mb-3 mb-md-0">
                    <label class="form-label text-muted">Account creation date</label>
                    <div class="info-value" th:text="${profile.createdAt}">2025-12-10T08:00</div>
                </div>
                <div class="col-md-6">
                    <label class="form-label text-muted">Status</label>
                    <div>
                        <span class="badge px-3 py-2 rounded-pill"
                              th:classappend="${profile.status == 'ACTIVE'} ? 'bg-success-subtle text-success fw-semibold'
                                           : 'bg-secondary-subtle text-secondary fw-semibold'"
                              th:text="${profile.status}">
                            ACTIVE
                        </span>
                    </div>
                </div>
            </div>

            <!-- Hàng 4: Xác minh email + Vai trò -->
            <div class="row mb-4">
                <div class="col-md-6 mb-3 mb-md-0">
                    <label class="form-label text-muted">Verify email</label>
                    <div>
                        <span th:if="${profile.verified}"
                              class="badge bg-success-subtle text-success fw-semibold px-3 py-2 rounded-pill">
                            Verified
                        </span>
                        <span th:if="${!profile.verified}"
                              class="badge bg-warning-subtle text-warning fw-semibold px-3 py-2 rounded-pill">
                            Not verified
                        </span>
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label text-muted">Role</label>
                    <div class="info-value" th:text="${profile.role.roleName}">CUSTOMER</div>
                </div>
            </div>

            <hr class="my-3">

            <!-- Buttons -->
            <div class="d-flex flex-wrap justify-content-end gap-2 mt-3">
                <!-- Nút Cập nhật thông tin -->
                <button class="btn btn-dark-soft px-4" data-bs-toggle="modal" data-bs-target="#updateInfoModal">
                    Update information
                </button>

                <!-- Nút Đổi mật khẩu -->
                <a class="btn btn-outline-warning px-4" th:href="@{/change-password}">
                    Change password
                </a>
            </div>

        </div>
    </div>
</div>

<!-- =========================
     MODAL UPDATE INFO
========================= -->
    <div class="modal fade" id="updateInfoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <form class="modal-content" method="post" th:action="@{/profile/update}">
                <div class="modal-header">
                    <h5 class="modal-title">Update information</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Full name</label>
                        <input type="text" class="form-control"
                               name="fullName"
                               th:value="${profile.fullName}"
                               pattern="^[A-Za-zÀ-ÖØ-öø-ÿ .'-]{3,100}$"
                               minlength="3" maxlength="100"
                               title="Full name 3-100 characters, only letters and spaces" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Phone</label>
                        <input type="text" class="form-control"
                               name="phone"
                               th:value="${profile.phone}"
                               pattern="^(09|03)\d{8}$"
                               minlength="10" maxlength="10"
                               title="Phone must have 10 digits and start with 09 or 03">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Address</label>
                        <input type="text" class="form-control"
                               name="address"
                               th:value="${profile.address}"
                               minlength="5" maxlength="200"
                               title="Address 5-200 characters">
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-dark-soft w-100">
                        Save changes
                    </button>
                </div>
            </form>
        </div>
    </div>
    <div th:if="${updateError}" class="alert alert-danger">
        <span th:text="${updateError}"></span>
    </div>


    <!-- =========================
         MODAL UPLOAD AVATAR
    ========================= -->
    <div class="modal fade" id="updateAvatarModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <form class="modal-content"
                  method="post"
                  th:action="@{/profile/update-avatar}"
                  enctype="multipart/form-data">

                <div class="modal-header">
                    <h5 class="modal-title">Update avatar</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Select new image</label>
                        <input type="file"
                               class="form-control"
                               name="avatar"
                               accept="image/*"
                               required>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-dark-soft w-100">
                        Save changes
                    </button>
                </div>
            </form>
        </div>
    </div>
    <div th:if="${avatarError}" class="alert alert-danger">
        <span th:text="${avatarError}"></span>
    </div>


</div>
</div>

<!-- If non-customer (seller/admin/mod/manager): render sidebar layout and inject content -->
<div th:if="${account != null and account.role.roleName.name() != 'CUSTOMER'}" th:replace="common/sidebar-header :: role-sidebar">
    <div th:replace="common/header :: header"></div>
    <th:block th:fragment="content">
        <div class="container py-5">

        <div class="profile-wrapper mx-auto">

            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="fw-bold mb-1">Account information</h2>
                    <p class="text-muted mb-0">Manage your personal information and account security.</p>
                </div>
            </div>

            <!-- Alerts -->
            <div th:if="${param.updated}" class="alert alert-success mb-4">
                Information has been updated successfully.
            </div>
            <div th:if="${param.avatarUpdated}" class="alert alert-success mb-4">
                Avatar has been updated successfully.
            </div>

            <!-- Avatar -->
            <div class="text-center mb-4">
                <img th:if="${profile.images != null}"
                     th:src="@{'/uploads/avatar/' + ${profile.images}}"
                     class="rounded-circle shadow-sm"
                     style="width: 120px; height: 120px; object-fit: cover;"
                     alt="Avatar">
                <img th:if="${profile.images == null}"
                     th:src="@{'/uploads/avatar/default.png'}"
                     class="rounded-circle shadow-sm"
                     style="width: 120px; height: 120px; object-fit: cover;"
                     alt="Avatar">
            </div>



            <!-- Button upload avatar -->
            <div class="text-center mb-4">
                <button class="btn btn-dark-soft" data-bs-toggle="modal" data-bs-target="#updateAvatarModal">
                    Change avatar
                </button>
            </div>

            <!-- Card nội dung -->
            <div class="profile-card shadow-sm rounded-4 p-4">

                <!-- Hàng 1: Họ tên + Email -->
                <div class="row mb-3">
                    <div class="col-md-6 mb-3 mb-md-0">
                        <label class="form-label text-muted">Full name</label>
                        <div class="info-value" th:text="${profile.fullName}">Nguyễn Văn A</div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label text-muted">Email (cannot be changed)</label>
                        <input class="form-control info-readonly" th:value="${profile.email}" readonly>
                    </div>
                </div>

                <!-- Hàng 2: SĐT + Địa chỉ -->
                <div class="row mb-3">
                    <div class="col-md-6 mb-3 mb-md-0">
                        <label class="form-label text-muted">Phone</label>
                        <div class="info-value" th:text="${profile.phone}">0123456789</div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label text-muted">Address</label>
                        <div class="info-value" th:text="${profile.address}">Hà Nội</div>
                    </div>
                </div>

                <!-- Hàng 3: Ngày tạo + Trạng thái -->
                <div class="row mb-3">
                    <div class="col-md-6 mb-3 mb-md-0">
                        <label class="form-label text-muted">Account creation date</label>
                        <div class="info-value" th:text="${profile.createdAt}">2025-12-10T08:00</div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label text-muted">Status</label>
                        <div>
                            <span class="badge px-3 py-2 rounded-pill"
                                  th:classappend="${profile.status == 'ACTIVE'} ? 'bg-success-subtle text-success fw-semibold'
                                               : 'bg-secondary-subtle text-secondary fw-semibold'"
                                  th:text="${profile.status}">
                                ACTIVE
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Hàng 4: Xác minh email + Vai trò -->
                <div class="row mb-4">
                    <div class="col-md-6 mb-3 mb-md-0">
                        <label class="form-label text-muted">Verify email</label>
                        <div>
                            <span th:if="${profile.verified}"
                                  class="badge bg-success-subtle text-success fw-semibold px-3 py-2 rounded-pill">
                                Verified
                            </span>
                            <span th:if="${!profile.verified}"
                                  class="badge bg-warning-subtle text-warning fw-semibold px-3 py-2 rounded-pill">
                                Not verified
                            </span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label text-muted">Role</label>
                        <div class="info-value" th:text="${profile.role.roleName}">CUSTOMER</div>
                    </div>
                </div>

                <hr class="my-3">

                <!-- Buttons -->
                <div class="d-flex flex-wrap justify-content-end gap-2 mt-3">
                    <!-- Nút Cập nhật thông tin -->
                    <button class="btn btn-dark-soft px-4" data-bs-toggle="modal" data-bs-target="#updateInfoModal">
                        Update information
                    </button>

                    <!-- Nút Đổi mật khẩu -->
                    <a class="btn btn-outline-warning px-4" th:href="@{/change-password}">
                        Change password
                    </a>
                </div>

            </div>
        </div>
        </div>

        <!-- =========================
             MODAL UPDATE INFO
        ========================= -->
        <div class="modal fade" id="updateInfoModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <form class="modal-content" method="post" th:action="@{/profile/update}">
                    <div class="modal-header">
                        <h5 class="modal-title">Update information</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Full name</label>
                            <input type="text" class="form-control"
                                   name="fullName"
                                   th:value="${profile.fullName}"
                                   pattern="^[\p{L} .'-]{3,100}$"
                                   minlength="3" maxlength="100"
                                   title="Full name 3-100 characters, only letters and spaces" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Phone</label>
                            <input type="text" class="form-control"
                                   name="phone"
                                   th:value="${profile.phone}"
                                   pattern="^(09|03)\d{8}$"
                                   minlength="10" maxlength="10"
                                   title="Phone must have 10 digits and start with 09 or 03">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Address</label>
                            <input type="text" class="form-control"
                                   name="address"
                                   th:value="${profile.address}"
                                   minlength="5" maxlength="200"
                                   title="Address 5-200 characters">
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-dark-soft w-100">
                            Save changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <div th:if="${updateError}" class="alert alert-danger">
            <span th:text="${updateError}"></span>
        </div>


        <!-- =========================
             MODAL UPLOAD AVATAR
        ========================= -->
        <div class="modal fade" id="updateAvatarModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <form class="modal-content" method="post" th:action="@{/profile/update-avatar}" enctype="multipart/form-data">
                    <div class="modal-header">
                        <h5 class="modal-title">Update avatar</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Select new image</label>
                        <input type="file" class="form-control" name="avatar" accept="image/*" required>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-dark-soft w-100">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
        <div th:if="${avatarError}" class="alert alert-danger">
            <span th:text="${avatarError}"></span>
        </div>

    </th:block>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script th:if="${openUpdateModal}">
    new bootstrap.Modal(
        document.getElementById('updateInfoModal')
    ).show();
</script>

<script th:if="${openAvatarModal}">
    document.addEventListener('DOMContentLoaded', function () {
        const modalEl = document.getElementById('updateAvatarModal');
        if (modalEl) {
            new bootstrap.Modal(modalEl).show();
        }
    });
</script>


</body>
</html>
